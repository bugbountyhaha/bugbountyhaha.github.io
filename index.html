from fastapi import FastAPI, Request
from fastapi.responses import HTMLResponse, PlainTextResponse
from fastapi.staticfiles import StaticFiles
import threading
import time
import requests

app = FastAPI()
PING_URL = "https://dufnepqyrqkvfquogfzmd3hf6iziiwnqz.oast.fun"  # Change to your target
PING_RATE = 30  # per second
pinging = False

def ping_loop():
    while True:
        try:
            requests.get(PING_URL, timeout=2)
        except:
            pass
        time.sleep(1 / PING_RATE)

@app.get("/", response_class=PlainTextResponse)
async def root(request: Request):
    global pinging
    if not pinging:
        threading.Thread(target=ping_loop, daemon=True).start()
        pinging = True
        return "Started pinging " + PING_URL
    else:
        return "Already pinging " + PING_URL

# Optional: serve static HTML if accessed from browser
app.mount("/static", StaticFiles(directory="static"), name="static")
